# 엘라스틱 스택 운영

### 1. 엘라스틱 스택(Elastic Stack) 개요

엘라스틱 스택은 검색 및 데이터 분석을 위해 개발된 오픈소스 소프트웨어 스택입니다. '전문 검색' 기능 요구에 맞춰 탄생했으며, 각기 다른 데이터 수집, 검색, 시각화 도구들이 하나의 생태계를 이루고 있습니다.

- **Elasticsearch**: 하둡을 만든 더그 커팅이 개발한 검색 엔진 라이브러리인 **루씬(Lucene)**을 기반으로, 샤이 배넌(Shay Banon)이 제작한 분산 검색 엔진입니다.
- **Logstash**: 샤이 배넌의 지인 요르단 시셀이 개발한 오픈소스 데이터 수집 도구로, 로그 데이터를 다양한 보관함에 전송할 수 있습니다.
- **Kibana**: 또 다른 지인 라시드 칸이 만든 시각화 UI로, 데이터를 차트나 그래프로 시각화할 수 있게 해줍니다.
- **Beats**: 2015년 패킷비트와 협업하여 개발한 경량 데이터 수집기입니다.

이러한 구성 요소들은 원래 **ELK 스택**(Elasticsearch, Logstash, Kibana)이라고 불렸으나, Beats의 추가로 **Elastic Stack**이라는 명칭이 생겼습니다.

---

### 2. 엘라스틱 스택의 구성 요소

### 1) Elasticsearch - 분산 검색 엔진

Elasticsearch는 다음과 같은 주요 특징을 가진 분산 검색 엔진입니다.

- **데이터 저장**: 모든 데이터를 JSON 도큐먼트 형태로 저장하며, 텍스트 외에도 숫자, 날짜, 지리, IP 주소 등 다양한 타입의 데이터 검색에 최적화되어 있습니다. 이를 **NoSQL** 데이터베이스로 간주할 수 있습니다.
- **역인덱스 구조**: 검색 시점이 아닌 인덱싱 시점에 텍스트 데이터를 용어 단위로 분해해 **역인덱스**를 생성합니다. 숫자나 키워드 타입 데이터는 집계를 위해 컬럼 기반 자료구조에 저장해, 뛰어난 성능을 제공합니다.
- **스코어링**: 단순 필드값 정렬이 아닌 **연관도 기반 정렬**을 제공합니다. 검색어 유사도에 따라 스코어를 부여해 검색 결과를 정렬하며, 스코어링 기준은 사용자가 설정할 수 있습니다.
- **확장성 및 안정성**: 노드를 추가해 **데이터 복제**를 통해 안정적으로 운영할 수 있습니다. REST API를 통해 언어에 관계없이 사용하기 쉽도록 설계되었습니다.
- **단점**: 리소스와 저장 공간을 많이 소모하며, 데이터 업데이트 시 비용이 높다는 점이 있습니다. 데이터 업데이트 시 비용이 높기 때문에 immutable한 시계열 데이터 유형을 다루기에 좋습니다.

이러한 특징들 덕분에 Elasticsearch는 다른 NoSQL 데이터베이스와 차별화된 높은 검색 성능을 제공합니다.

참고 : [https://velog.io/@ko1586/Search-Process-뭔데](https://velog.io/@ko1586/Search-Process-%EB%AD%94%EB%8D%B0)

### 2) Kibana - 시각화와 Elasticsearch 관리 도구

- **Kibana**는 Elasticsearch의 관리 및 시각화를 간편하게 해주는 도구로, Elasticsearch와 RESTful API로 상호작용해 데이터를 손쉽게 조회하고 관리할 수 있게 합니다. CLI로 `curl` 명령을 작성하는 번거로움을 덜어주며, 대부분의 Elasticsearch 관리 작업과 모니터링 기능을 제공해 클릭 몇 번으로 다양한 시각화 대시보드를 구성할 수 있습니다.
- **주요 기능**: 실시간 로그 모니터링, 성능 모니터링을 위한 **APM**(Application Performance Monitoring), 보안 이벤트 관리를 위한 **SIEM**(Security Information and Event Management) 등 강력한 관제 솔루션을 갖추고 있습니다.

---

### 3) Logstash - 이벤트 수집과 정제를 위한 도구

- **Logstash**는 Elasticsearch에 데이터를 적재하기 위해 필수적인 데이터 수집 및 가공 도구입니다. 다양한 소스로부터 로그, 메트릭, 웹 애플리케이션 이벤트 데이터를 수집하고 정제할 수 있습니다.
- **특징**: 코딩 없이 간단한 설정으로 데이터를 가공할 수 있으며, 200개 이상의 플러그인으로 다양한 데이터 처리 기능을 제공합니다. **INPUT-FILTER-OUTPUT** 구조로 동작하고, 배치 처리와 병렬 처리가 가능하여 대량 데이터 수집 시에도 효율적입니다.
- **안정성**: 영속적 큐를 통해 최소 1회 전송을 보장하며, 부하가 높은 상황에서도 안정성을 유지합니다.

---

### 4) Beats - 엣지단에서 동작하는 경량 수집 도구

- **Beats**는 경량 로그 수집 도구로, Logstash의 무거운 기능 대신 단순한 로그 수집에 최적화되어 있습니다.
- **종류**: 주로 사용하는 Beats에는 시스템 메트릭 수집을 위한 **Metricbeat**, 파일 로그 수집을 위한 **Filebeat** 등이 있으며, 간단하고 가벼운 에이전트로 엣지 단에서 데이터를 수집합니다.
- **활용 방식**: 이벤트 가공 없이 데이터를 Logstash로 전송하여 Logstash에서 데이터를 추가로 가공하는 방식으로 사용됩니다.

---

### 기타 - 성능 모니터링(APM) 및 보안 이벤트 분석(SIEM)

- **APM**: 애플리케이션 성능 모니터링 기능으로, 시스템 성능 및 애플리케이션 상태를 실시간으로 추적할 수 있습니다.
- **SIEM**: 보안 이벤트 관리 솔루션으로, 로그 및 보안 데이터를 분석하여 보안 이벤트를 감지하고 관리합니다.

---

### 3. 엘라스틱 스택의 주요 용도

**전문 검색 엔진**

- ◦ 역인덱싱을 통해 빠른 전문 검색을 지원합니다. 일반적인 LIKE 검색은 데이터가 많아지면 인덱스 없이 빠른 검색이 어려운 반면, Elasticsearch는 용어 단위로 분석하여 역인덱스를 기반으로 빠른 검색이 가능합니다.

**로그 통합 분석**

- ◦ **Beats**는 각 장비의 로그를 적은 리소스로 신속히 수집하며, 수집된 로그를 **Logstash**가 일원화된 형식으로 가공합니다. **Elasticsearch**는 빠른 인덱싱과 텍스트 검색을 제공하고, **Kibana**는 시간에 따른 로그 데이터를 시각화하여 모니터링을 가능하게 합니다.

**보안 이벤트 분석**

- ◦ SIEM 또는 ESM에서 수집한 보안 이벤트 데이터를 기반으로, 불법 로그인 시도나 사용자 접근 패턴 분석을 통해 위협을 식별하고, 실시간으로 이상 이벤트를 탐지할 수 있습니다.

**애플리케이션 성능 분석**

- ◦ *APM(Application Performance Monitoring)**을 통해 애플리케이션 성능 지표를 수집 및 분석하며, **Metricbeat**나 **Packetbeat**를 통해 메트릭 데이터를 수집할 수도 있습니다. 이를 통해 성능 문제를 신속하게 파악할 수 있습니다.

**머신러닝**

- ◦ Elasticsearch는 시계열 데이터 저장에 유리해, 머신러닝을 통해 시계열 데이터를 분석하여 이상 징후를 탐지하거나 추세를 예측하는 데 활용할 수 있습니다.

**빅데이터 플랫폼의 일부**

- ◦ *카프카(Kafka)**와 **하둡(Hadoop)**을 Elasticsearch와 연동해 빅데이터 분석에 활용할 수 있습니다. Kafka를 통해 일시적인 인덱싱 과부하나 장애 발생 시에도 데이터 유실을 방지하고, 다른 시스템과 연계가 용이해집니다.
- ◦ *아파치 스파크(Apache Spark)**와 Elasticsearch를 함께 사용하면, 인덱싱되지 않은 대량의 데이터는 Spark에서 일괄 처리하고, 이미 인덱싱된 데이터는 Elasticsearch에서 빠르게 검색하여 집계 엔진이나 중간 데이터 저장소로 사용할 수 있습니다.